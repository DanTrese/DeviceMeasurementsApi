<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SSE Stream Manager</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        #log {
            background: #f1f1f1;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
        button {
            margin-right: 10px;
            padding: 10px 20px;
        }
    </style>
</head>
<body>

    <h1>üì° SSE –°—Ç—Ä–∏–º</h1>

    <button onclick="startStream()">–°—Ç–∞—Ä—Ç</button>
    <button onclick="stopStream()">–°—Ç–æ–ø —Å —Å–µ—Ä–≤–µ—Ä–∞</button>
    <button onclick="disconnect()">–û—Ç–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>

    <div id="log"></div>

    <script>
        let eventSource = null;
        const log = document.getElementById("log");

        function logMessage(msg) {
            const div = document.createElement("div");
            div.textContent = msg;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function startStream() {
            if (eventSource && eventSource.readyState === 1) {
                logMessage("üîÅ –£–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ.");
                return;
            }

            eventSource = new EventSource("/api/SSE/sse");

            eventSource.onmessage = function (event) {
                logMessage("üì® " + event.data);
            };

            eventSource.onerror = function () {
                logMessage("‚ùå –ü–æ—Ç–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞.");
                eventSource.close();
            };

            logMessage("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.");
        }

        function stopStream() {
            fetch("/api/SSE/stop", {
                method: "POST"
            }).then(() => logMessage("‚õî –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –ø–æ—Ç–æ–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞"));
        }

        function disconnect() {
            if (eventSource) {
                eventSource.close();
                logMessage("üö™ –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è –æ—Ç –ø–æ—Ç–æ–∫–∞");
            }
        }
    </script>
</body>
</html>
